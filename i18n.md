# i18n Guide

## Overview

This project uses a custom i18n module for multilingual support. Currently supported languages:
- English (en)
- Simplified Chinese (zh-CN)

## File Structure

```
webui/
â”œâ”€â”€ i18n.js                  # i18n core module
â”œâ”€â”€ locales/                 # Language files directory
â”‚   â”œâ”€â”€ en.json             # English translations
â”‚   â””â”€â”€ zh-CN.json          # Simplified Chinese translations
â”œâ”€â”€ index.js                # Main application file (i18n integrated)
â””â”€â”€ index.html              # HTML (with data-i18n attributes)
```

## Core Features

### 1. Automatic Language Detection
- Prioritizes user's last selected language (stored in localStorage)
- Falls back to browser language
- Final fallback to English

### 2. Language Switching
Click the language button (ğŸŒ icon) at the top to switch languages. The entire interface will update instantly.

### 3. Translation Text Retrieval
Use the `t()` function to get translated text:

```javascript
import { t } from './i18n.js';

// Basic usage
const text = t('actions.save');  // "Save" or "ä¿å­˜"

// With parameter interpolation
const message = t('welcome.message', { name: 'John' });
// "Welcome, John!" or "æ¬¢è¿ï¼ŒJohnï¼"
```

## Usage in Code

### HTML Usage

Add `data-i18n` attributes to HTML elements:

```html
<!-- Text content -->
<button data-i18n="actions.save">Save</button>

<!-- Attribute translation -->
<input data-i18n-placeholder="common.search" placeholder="Search">
<button data-i18n-title="actions.close" title="Close">Ã—</button>
<md-outlined-text-field data-i18n-label="common.name" label="Name">
```

Supported attributes:
- `data-i18n` - Updates element's textContent
- `data-i18n-placeholder` - Updates placeholder attribute
- `data-i18n-title` - Updates title attribute
- `data-i18n-label` - Updates label attribute

### JavaScript Usage

```javascript
import { t, setLocale, getLocale } from './i18n.js';

// Get translated text
toast(t('messages.failedToSave'));

// Switch language
await setLocale('zh-CN');

// Get current language
const currentLang = getLocale(); // 'en' or 'zh-CN'
```

### Dynamic Content Updates

Listen for the `localeChanged` event when language switches:

```javascript
window.addEventListener('localeChanged', () => {
    // Re-render dynamic content
    updateDynamicContent();
});
```

## Translation File Format

Language files use JSON format with nested structure support:

```json
{
  "app": {
    "name": "mountify",
    "version": "Version"
  },
  "actions": {
    "save": "Save",
    "cancel": "Cancel"
  },
  "messages": {
    "failedToSave": "Failed to save"
  }
}
```

Access translations using dot notation: `t('app.name')`, `t('actions.save')`

## Adding New Languages

1. Create a new language file in the `locales/` directory, e.g., `zh-CN.json`
2. Copy the structure from `en.json` and translate all text
3. Add the new language in the `getAvailableLocales()` function in `i18n.js`:

```javascript
export function getAvailableLocales() {
    return [
        { code: 'en', name: 'English' },
        { code: 'zh-CN', name: 'ç®€ä½“ä¸­æ–‡' }  // New addition
    ];
}
```

4. If needed, add alias mapping in the `normalizeLocale()` function

## Adding New Translation Keys

1. Add the same key in all language files:

**en.json:**
```json
{
  "settings": {
    "newOption": "New Option"
  }
}
```

2. Use in code:
```javascript
const text = t('settings.newOption');
```

## Parameter Interpolation

Translation text supports parameter interpolation:

**Language file:**
```json
{
  "welcome": "Hello, {name}! You have {count} messages."
}
```

**Usage:**
```javascript
const text = t('welcome', { name: 'John', count: 5 });
// Result: "Hello, John! You have 5 messages."
```

## Best Practices

1. **Keep keys consistent**: All language files should have the same key structure
2. **Use semantic key names**: Use `actions.save` instead of `btn1`
3. **Group management**: Organize translation keys by functional modules
4. **Timely updates**: Update all language files simultaneously when adding new features
5. **Fallback handling**: If translation is missing, the key name itself will be displayed

## API

### init(locale)
Initialize the i18n system
- **Parameters**: `locale` (optional) - Language code to load
- **Returns**: Promise

### t(key, params)
Get translated text
- **Parameters**: 
  - `key` - Translation key (supports dot-separated nested keys)
  - `params` - Optional parameter object for interpolation
- **Returns**: Translated string

### setLocale(locale)
Switch language
- **Parameters**: `locale` - Language code
- **Returns**: Promise

### getLocale()
Get current language
- **Returns**: Current language code string

### getAvailableLocales()
Get all available languages
- **Returns**: Array of language objects `[{code, name}, ...]`

### updatePageText()
Update all elements with `data-i18n` attributes on the page
- **Returns**: void

## Events

### localeChanged
Triggered when language is switched

```javascript
window.addEventListener('localeChanged', (event) => {
    console.log('Language changed to:', event.detail.locale);
});
```

## Debugging

If a translation key is not found, a warning will be logged to the console:
```
Translation key not found: some.missing.key
```
